<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="favicon.png?v=3" type="image/png" />
  <link rel="stylesheet" href="css/site.css?v=7" />
  <title>lockify — AES-256-GCM (encrypt/decrypt)</title>
  <meta name="color-scheme" content="light dark" />
  
</head>
<body>
 <header>
  <div class="brand">
    <img src="favicon.png" alt="lockify" width="22" height="22" />
    <span>lockify</span>
  </div>
  <nav> 
    <a href="./">Início</a> 
    <a href="./snippets-index.html" class="current">Snippets</a> 
    <a href="https://github.com/lockifyoffice/lockify" target="_blank" rel="noopener">GitHub</a> 
  </nav>
</header>

  <main>
    <h1>AES-256-GCM — encrypt/decrypt (texto)</h1>
    <p class="muted">Use IV único (12 bytes) por cifra. Payload: IV(12) + CT + TAG(16), tudo em base64.</p>

    <div class="tabs">
      <button class="tab active" data-lang="node">Node.js</button>
      <button class="tab" data-lang="python">Python</button>
    </div>

    <pre><code id="code"></code></pre>
    <button class="copy" id="copy">Copiar</button>

    <div class="card muted">
      Dicas: não reutilize IV com a mesma chave. Serialize IV+CT+TAG juntos. AAD (dados adicionais) é opcional.
    </div>
  </main>

  <script>
    const snippets = {
      node:
`const crypto = require('crypto');

function encryptGCM(plaintext, keyB64, aad){
  const key = Buffer.from(keyB64, 'base64'); // 32 bytes (AES-256)
  const iv = crypto.randomBytes(12);
  const cipher = crypto.createCipheriv('aes-256-gcm', key, iv);
  if (aad) cipher.setAAD(Buffer.from(aad, 'utf8'));
  const ct = Buffer.concat([cipher.update(plaintext, 'utf8'), cipher.final()]);
  const tag = cipher.getAuthTag();
  return Buffer.concat([iv, ct, tag]).toString('base64');
}

function decryptGCM(payloadB64, keyB64, aad){
  const key = Buffer.from(keyB64, 'base64');
  const buf = Buffer.from(payloadB64, 'base64');
  const iv  = buf.subarray(0, 12);
  const tag = buf.subarray(buf.length - 16);
  const ct  = buf.subarray(12, buf.length - 16);
  const decipher = crypto.createDecipheriv('aes-256-gcm', key, iv);
  if (aad) decipher.setAAD(Buffer.from(aad, 'utf8'));
  decipher.setAuthTag(tag);
  return Buffer.concat([decipher.update(ct), decipher.final()]).toString('utf8');
}

// Exemplo:
// const keyB64 = crypto.randomBytes(32).toString('base64');
// const payload = encryptGCM('segredo', keyB64);
// const plain = decryptGCM(payload, keyB64);`,
      python:
`# pip install cryptography
import os, base64
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes

def encrypt_gcm(plaintext: str, key_b64: str, aad: str | None = None) -> str:
    key = base64.b64decode(key_b64)  # 32 bytes
    iv = os.urandom(12)
    encryptor = Cipher(algorithms.AES(key), modes.GCM(iv)).encryptor()
    if aad:
        encryptor.authenticate_additional_data(aad.encode())
    ct = encryptor.update(plaintext.encode()) + encryptor.finalize()
    return base64.b64encode(iv + ct + encryptor.tag).decode()

def decrypt_gcm(payload_b64: str, key_b64: str, aad: str | None = None) -> str:
    key = base64.b64decode(key_b64)
    data = base64.b64decode(payload_b64)
    iv, tag, ct = data[:12], data[-16:], data[12:-16]
    decryptor = Cipher(algorithms.AES(key), modes.GCM(iv, tag)).decryptor()
    if aad:
        decryptor.authenticate_additional_data(aad.encode())
    return (decryptor.update(ct) + decryptor.finalize()).decode()

# Exemplo:
# key_b64 = base64.b64encode(os.urandom(32)).decode()
# payload = encrypt_gcm("segredo", key_b64)
# plain = decrypt_gcm(payload, key_b64)`
    };

    let current = 'node';
    const codeEl = document.getElementById('code');
    const render = () => { codeEl.textContent = snippets[current]; };
    render();

    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        current = btn.dataset.lang;
        render();
      });
    });

    document.getElementById('copy').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(codeEl.textContent);
        const btn = document.getElementById('copy');
        const prev = btn.textContent; btn.textContent = 'Copiado!';
        setTimeout(() => btn.textContent = prev, 1200);
      } catch {
        alert('Não foi possível copiar. Copie manualmente.');
      }
    });
  </script>
</body>
</html>
